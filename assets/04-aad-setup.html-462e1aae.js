import{_ as s,r,o as i,c as n,a as e,d as t,b as a,e as c}from"./app-515fa09f.js";const d="/milestone-docs/assets/aad-new-registration-cda2a5ad.png",p="/milestone-docs/assets/aad-new-registration-form-a6473e93.png",h="/milestone-docs/assets/aad-app-registration-root-8fe4f258.png",l="/milestone-docs/assets/aad-app-registration-access-id-tokens-7f829656.png",u="/milestone-docs/assets/aad-app-registration-permissions-add-53e8e67d.png",m="/milestone-docs/assets/aad-app-registration-permissions-graph-eebd5b9a.png",g="/milestone-docs/assets/aad-app-registration-permissions-delegated-901159d5.png",f="/milestone-docs/assets/aad-app-registration-permissions-ebb7b9be.png",_="/milestone-docs/assets/aad-secrets-new-40d4cbec.png",A="/milestone-docs/assets/aad-secrets-value-d45f8a37.png",b={},q=e("h1",{id:"azure-active-directory-setup",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#azure-active-directory-setup","aria-hidden":"true"},"#"),t(" Azure Active Directory setup")],-1),v=e("p",null,"This guide will lead you through the creation of an Azure AD app registration, so that the application can leverage Azure AD features, and access other users' accounts or perform actions on their behalf.",-1),k=e("h2",{id:"step-1-new-app-registration",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#step-1-new-app-registration","aria-hidden":"true"},"#"),t(" Step 1. New app registration")],-1),w={href:"https://portal.azure.com/#view/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/~/RegisteredApps",target:"_blank",rel:"noopener noreferrer"},y={class:"custom-container details"},I=e("summary",null,"If link does not work",-1),P={href:"https://portal.azure.com",target:"_blank",rel:"noopener noreferrer"},D=c('<p>Click on the &quot;New registration&quot; button.</p><p><img src="'+d+'" alt=""></p><p>On the next page, enter a meaningful name for the &quot;Name&quot; field, then choose &quot;Accounts in this organizational directory only (Single tenant)&quot; for the account types. In the &quot;Redirect URI&quot; field, select &quot;Web&quot; and enter the URI according to the purpose of the registration.</p><p>Refer to the table below for the correct redirect URIs (replace <code>example.com</code> with the appropriate hostname, also note the use of <code>https://</code>).</p><table><thead><tr><th>Purpose</th><th>URI</th></tr></thead><tbody><tr><td>Sending emails</td><td><code>https://example.com/msgraph/oauth</code></td></tr><tr><td>Authenticating users</td><td><code>https://example.com/login/oauth/aad/callback</code></td></tr></tbody></table><p><img src="'+p+'" alt=""></p><p>After completing the form, click &quot;Register&quot;. You should be redirected to a page that looks like this:</p><p><img src="'+h+'" alt=""></p><h2 id="step-2-configure-aad-app" tabindex="-1"><a class="header-anchor" href="#step-2-configure-aad-app" aria-hidden="true">#</a> Step 2. Configure AAD app</h2><h3 id="step-2-1-enable-access-and-id-tokens" tabindex="-1"><a class="header-anchor" href="#step-2-1-enable-access-and-id-tokens" aria-hidden="true">#</a> Step 2.1. Enable access and ID tokens</h3><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>This step is only necessary if the Azure AD registration is used for authenticating users. For sending emails, you may skip this step and go to <a href="#step-22-configure-api-permissions">step 2.2</a>.</p></div><p>From the app registration&#39;s page, select &quot;Authentication&quot; from the side bar. Scroll down and find &quot;Implicit grant and hybrid flows&quot;.</p><p>Select to enable both checkboxes under this section.</p><p><img src="'+l+'" alt=""></p><h3 id="step-2-2-configure-api-permissions" tabindex="-1"><a class="header-anchor" href="#step-2-2-configure-api-permissions" aria-hidden="true">#</a> Step 2.2. Configure API permissions</h3><p>From the sidebar, find and click &quot;API permissions&quot;.</p><p>On the API permissions page, click &quot;Add a permission&quot;.</p><p><img src="'+u+'" alt=""></p><p>Then, from the panel, first click &quot;Microsoft Graph&quot;, then &quot;Delegated permissions&quot;.</p><p><img src="'+m+'" alt=""></p><p><img src="'+g+'" alt=""></p><p>Next, search for the desired permissions in the search bar and select the appropriate checkboxes. Refer to the table below for the correct permissions to enable.</p><table><thead><tr><th>Purpose</th><th>Permissions</th></tr></thead><tbody><tr><td>Sending emails</td><td><code>Mail.Send</code>, <code>User.Read</code>, <code>offline_access</code></td></tr><tr><td>Authenticating users</td><td><code>openid</code></td></tr></tbody></table><p>When you are done, click &quot;Add permissions&quot;.</p><p>Verify that the correct permissions were enabled.</p><p><img src="'+f+'" alt=""></p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>If the app is for authenticating users, you may remove all the other redundant permissions (e.g. <code>User.Read</code>).</p></div><h2 id="step-3-creating-tokens" tabindex="-1"><a class="header-anchor" href="#step-3-creating-tokens" aria-hidden="true">#</a> Step 3. Creating tokens</h2><p>Next, tokens (secrets) have to be obtained for the application to access the API.</p><p>From the sidebar, select &quot;Certificates &amp; secrets&quot;. On the secrets page, navigate to the &quot;Client secrets&quot; tab and click &quot;New client secret&quot;.</p><p><img src="'+_+'" alt=""></p><p>Then, enter a descriptive name and select a suitable expiry period. After that, click &quot;Add&quot;.</p><p>A new row will be added to the table, with the secret values uncovered.</p><div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>Be sure to copy the secret value NOW because it will not be shown again.</p></div><p><img src="'+A+'" alt=""></p><p>Now, copy the secret value (first) and the other parameters to the <code>.env</code> files. The table below shows which value corresponds to which environmental variable.</p><table><thead><tr><th>Environmental variable (emails / authentication)</th><th>Azure portal</th><th>Obtained from</th></tr></thead><tbody><tr><td><code>GRAPH_TENANT_ID</code> / <code>AUTH_AAD_TENANT_ID</code></td><td>Directory (tenant) ID</td><td>The &quot;Overview&quot; page of a registered app</td></tr><tr><td><code>GRAPH_APP_ID</code> / <code>AUTH_AAD_APP_ID</code></td><td>Application (client) ID</td><td>The &quot;Overview&quot; page of a registered app</td></tr><tr><td><code>GRAPH_APP_SECRET_ID</code> / <code>AUTH_AAD_APP_SECRET_ID</code></td><td>Secret ID</td><td>The &quot;Certificates &amp; secrets&quot; page of a registered app</td></tr><tr><td><code>GRAPH_APP_SECRET</code> / <code>AUTH_AAD_APP_SECRET</code></td><td>Secret value</td><td>The &quot;Certificates &amp; secrets&quot; page of a registered app</td></tr><tr><td><code>GRAPH_CALLBACK_URL</code> / <code>AUTH_AAD_CALLBACK_URL</code></td><td>Redirect URIs (one of them)</td><td>The &quot;Authentication&quot; page of a registered app</td></tr></tbody></table>',37);function T(R,x){const o=r("ExternalLinkIcon");return i(),n("div",null,[q,v,k,e("p",null,[t("Go to the "),e("a",w,[t("Azure AD app registrations page"),a(o)]),t(" on Azure Portal. Login with your Microsoft account if needed.")]),e("details",y,[I,e("p",null,[t("Navigate to "),e("a",P,[t("Azure portal"),a(o)]),t(' then search for and click on "Azure Active Directory". Next, from the left sidebar, find and click on "App registrations".')])]),D])}const S=s(b,[["render",T],["__file","04-aad-setup.html.vue"]]);export{S as default};
